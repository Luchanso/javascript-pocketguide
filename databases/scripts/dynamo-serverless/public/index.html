<!DOCTYPE html>
<html>
<head>
<title>Overview Projects Blockchain</title>
<link rel="stylesheet" type="text/css" href="css/p1.css"/>
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script> 
</head>
<body onload="getAllProjects()"></body>
<h1>Form To Fetch Data</h1>
      <form>
    
        <label for="projectnameFetch">Project Name</label>
        <input type="text" id="projectnameFetch" name="projectnameFetch" placeholder="Your project name..">
        <button type="button" class="btn btn-default btn-danger", onclick="deleteProject()">Delete</button></span>
      </form>
    </div>
  </form>  

<div class="container-fluid">
  <div id="database">
      <table id="resultTable">
          <thead>
          <tr>
          <th>Project Name</th>
          <th>Link</th>
          <th>Timestamp</th>
          <th>Remove from Table</th>
          </tr>
          </thead>
          <tbody>
          
          </tbody>
          </table>
  </div>
<form>
  <div class="form-horisontal">

    <div class="container">
      <form>
    
        <label for="projectname">Project Name</label>
        <input type="text" id="projectname" name="projectname" placeholder="Your project name..">
        <br>
        <label for="projectlink">Link</label>
        <input type="url" id="projectlink" name="projectlink" placeholder="Your project link..">
        <!-- <input type="submit" value="Submit" onclick="getFullList()"> -->
        <button type="button" class="btn btn-default btn-danger", onclick="getFullList()">Save</button></span>
      </form>
      <div id="content">
        <span id="message"></span>
      </div>

</div>
</body>
<script>
  const getFullList = () => {
      console.log('Starting to fetch the resource');
      const name = document.getElementById("projectname").value;
      const projectLink = document.getElementById("projectlink").value;
      console.log(name);
      console.log(projectLink);
      fetch(`http://localhost:3000/projects/${name}`, 
          {
            method: 'POST', 
            body: JSON.stringify({link: projectLink})
          })
          .then(response => {
            if (response.status === 200) {
              document.getElementById('message').innerHTML = "Saved to DB";
            } else {
              document.getElementById('message').innerHTML = "URL is not valid. Please doublecheck your URL";
            }
          })
          .catch(err => console.log(err));
  };

  const deleteProject = () => {
    const name = document.getElementById("projectnameFetch").value;
    console.log('I want to delete following project:', name);
    fetch(`http://localhost:3000/projects/${name}`, {method:'DELETE', body: "", headers:{'Content-Type':'text/plain'}})
        .then(response => console.log(response))
          .catch(err => console.log(err));
  };

  const getAllProjects = () => {
    fetch(`http://localhost:3000/projects/all`)
        .then(response => { 
          console.log(response);
          return response.json();
        })
        .then(data => {
            console.log('Starting to get results from DB', data.Items);
            const table = data.Items;
            table.forEach(function(item){
            $('tbody').append('<tr><td>'+item.name+'</td><td>'+item.link+'</td><td>'+item.timestamp+'</td></tr>')
});
            
          })
          .catch(err => console.log(err));
  }


  </script>
</html>

